# /swagger/paths.yaml
# Menggabungkan semua Paths API

# --- AUTH ROUTES (/auth) ---
/auth/login:
  post:
    tags: [Auth]
    summary: User login
    operationId: loginAuth
    security: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/LoginRequest"
    responses:
      "200": { description: Success }
      "401": { $ref: "#/components/responses/Unauthorized" }

/auth/register:
  post:
    tags: [Auth]
    summary: Register new user
    operationId: registerAuth
    security: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/RegisterRequest"
    responses:
      "201": { description: Created }
      "409": { $ref: "#/components/responses/Conflict" }

/auth/logout:
  post:
    tags: [Auth]
    summary: Logout user
    operationId: logoutAuth # Mengesampingkan security global (tidak butuh token untuk logout cookie)
    responses:
      "200": { description: Success }

/auth/verify:
  get:
    tags: [Auth]
    summary: Verify user session
    operationId: verifyAuth
    responses:
      "200": { description: Success }
      "401": { $ref: "#/components/responses/Unauthorized" }

/auth/reset:
  put:
    tags: [Auth]
    summary: Reset password
    operationId: resetAuth
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ResetRequest"
    responses:
      "200": { description: Success }
      "401": { $ref: "#/components/responses/Unauthorized" }
      "404": { $ref: "#/components/responses/NotFound" }

# --- USER ROUTES (/user) ---
/user:
  get:
    tags: [User]
    summary: Get all users
    operationId: getUsers
    parameters:
      - $ref: "#/components/parameters/SearchQuery"
      - $ref: "#/components/parameters/PaginationPage"
      - $ref: "#/components/parameters/PaginationLimit"
    responses:
      "200": { description: Success }

/user/u/{username}:
  get:
    tags: [User]
    summary: Get user by Username
    operationId: getUserByUsername
    parameters:
      - $ref: "#/components/parameters/UsernamePath"
    responses:
      "200": { description: Success }
      "404": { $ref: "#/components/responses/NotFound" }

/user/bio:
  post:
    tags: [User]
    summary: Generate user bio
    operationId: generateBio
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/generateBio"
    responses:
      "200": { description: Success }

/user/me:
  get:
    tags: [User]
    summary: Get user by ID
    operationId: getUserById
    responses:
      "200": { $ref: "#/components/schemas/User" }
      "404": { $ref: "#/components/responses/NotFound" }
  patch:
    tags: [User]
    summary: Update user profile (with file uploads)
    operationId: updateUser
    requestBody:
      required: true
      content:
        multipart/form-data:
          schema:
            $ref: "#/components/schemas/UpdateUserRequest"
    responses:
      "200": { description: Success }
      "404": { $ref: "#/components/responses/NotFound" }

# --- LINK ROUTES (/link) ---
/link:
  get:
    tags: [Link]
    summary: Get user links
    operationId: getLinks
    parameters:
      - $ref: "#/components/parameters/PaginationPage"
      - $ref: "#/components/parameters/PaginationLimit"
    responses:
      "200": { description: Success }
  post:
    tags: [Link]
    summary: Create new link
    operationId: postLink # Asumsi postLink adalah controller untuk router.post("/")
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/LinkRequest"
    responses:
      "201": { description: Created }

/link/{id}:
  get:
    tags: [Link]
    summary: Get link by ID
    operationId: getLinkById
    parameters:
      - $ref: "#/components/parameters/IdPath"
    responses:
      "200": { description: Success }
  patch:
    tags: [Link]
    summary: Update link details
    operationId: updateLink
    parameters:
      - $ref: "#/components/parameters/IdPath"
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/LinkRequest"
    responses:
      "200": { description: Success }
  delete:
    tags: [Link]
    summary: Hard delete a link
    operationId: deleteLink
    parameters:
      - $ref: "#/components/parameters/IdPath"
    responses:
      "200": { description: Success }

/link/{id}/reorder:
  patch:
    tags: [Link]
    summary: Reorder link
    operationId: updateLinkOrder
    parameters:
      - $ref: "#/components/parameters/IdPath"
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/OrderRequest"
    responses:
      "200": { description: Success }

# --- SOCIAL ROUTES ---
/social/active:
  get:
    tags: [Social]
    summary: Get active user social links
    operationId: getSocials
    parameters:
      - name: sort
        in: query
        schema: { type: string, enum: [order, created_at] }
        description: Field untuk pengurutan.
      - name: order
        in: query
        schema: { type: string, enum: [asc, desc] }
        description: Arah pengurutan.
      - $ref: "#/components/parameters/PaginationPage"
      - $ref: "#/components/parameters/PaginationLimit"
    responses:
      "200":
        description: Success
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SocialsResponse"

/social/all:
  get:
    tags: [Social]
    summary: Get all user social links (active and inactive)
    operationId: getSocialsAll
    parameters:
      - name: sort
        in: query
        schema: { type: string, enum: [order, created_at] }
        description: Field untuk pengurutan.
      - name: order
        in: query
        schema: { type: string, enum: [asc, desc] }
        description: Arah pengurutan.
      - $ref: "#/components/parameters/PaginationPage"
      - $ref: "#/components/parameters/PaginationLimit"
    responses:
      "200":
        description: Success
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SocialsResponse"

/social:
  put:
    tags: [Social]
    summary: Create or update a social link (Upsert)
    operationId: putSocial
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/SocialRequest"
    responses:
      "200":
        description: Success
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Social"
      "400": { description: Bad Request }

/social/{id}:
  put:
    tags: [Social]
    summary: Restore a social link
    operationId: restoreSocial
    parameters:
      - $ref: "#/components/parameters/IdPath"
    responses:
      "200":
        description: Success
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Social"
  delete:
    tags: [Social]
    summary: Soft-delete a social link
    operationId: deleteSocial # Ini melakukan soft-delete (is_active = false)
    parameters:
      - $ref: "#/components/parameters/IdPath"
    responses:
      "200":
        description: Success
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Social"

/social/{id}/reorder:
  patch:
    tags: [Social]
    summary: Reorder social link
    operationId: updateSocialOrder
    parameters:
      - $ref: "#/components/parameters/IdPath"
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/OrderRequest"
    responses:
      "200":
        description: Success
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Social"
